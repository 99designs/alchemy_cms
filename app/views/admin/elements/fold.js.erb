(function($) {
	
	<%- if @error -%>
	
	$("#element_<%= @element.id -%>_folder_spinner").replaceWith("<span class='error_icon' title='<%= @error -%>'>!</span>");
	
	<%- else -%>
	
	$('#element_<%= @element.id -%>').replaceWith('<%= escape_javascript render(:partial => "element", :object => @element) -%>');
	$('#element_area').sortable('refresh');
	Alchemy.ElementEditorSelector.bindEvent('#element_<%= @element.id -%>');

	<%- if @element.folded -%>

		<%- @element.rtf_contents.each do |content| -%>

		rtf_<%= content.id -%> = tinymce.get('<%= content.form_field_id -%>');
		if (rtf_<%= content.id -%>) {
			rtf_<%= content.id -%>.remove();
		};
		delete rtf_<%= content.id -%>;
		
		<%- end -%>
		
	<%- else -%>
	
		$('#element_<%= @element.id -%>').trigger('Alchemy.SelectElementEditor');
		Alchemy.SelectBox('#element_<%= @element.id -%> select');
		
		<%- @element.rtf_contents.each do |content| -%>
		TinymceHammer.addEditor('<%= content.form_field_id -%>');
		<%- end -%>
		
		Alchemy.ElementDirtyObserver('#element_<%= @element.id -%>');
	<%- end -%>
	
	<%- end -%>
	
})(jQuery);
