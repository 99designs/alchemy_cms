<%- alchemy_assets_set(:edit_page) -%>

<%- content_for(:javascript_includes) do -%>
	<%= tinymce_hammer_javascript_tags %>
<%- end -%>
<%- content_for(:subnavi) do -%>
<div id="sub_navigation">
    <%- for page in Page.all_locked_by(current_user) do -%>
    <%- if @page == page -%>
	<span class="page_status_and_name">
		<span class="page_name"><%= page.name %></span>
		<%- if multi_language? && !@layoutpage -%>
		<span class="flag <%= session[:language] %>"></span>
		<%- end -%>
		<span class="page_status <%= @page.public ? 'public' : 'not_public' %>" title="<%= @page.public ? _('Page public') : _('Page not public') %>"></span>
        <span class="page_status <%= @page.visible ? 'visible' : 'not_visible' %>" title="<%= @page.visible ? _('Page visible') : _('Page not visible') %>"></span>
        <span class="page_status <%= @page.restricted ? 'restricted' : 'not_restricted' %>" title="<%= @page.restricted ? _('Page restricted') : _('Page not restricted') %>"></span>
	</span>
    <%- else -%>
    <% link_to edit_admin_page_path(page) do %>
    <span class="page_name"><%= page.name %></span>
    <% end %>
    <%- end -%>
	<%- end -%>
</div>
<%- end -%>
<%- content_for(:toolbar) do -%>
<div id="toolbar">
	<div id="toolbar_buttons">
		<div class="button_with_label">
			<% form_tag(
				unlock_admin_page_path(
					@page,
					:redirect_to => @layoutpage ? admin_layoutpages_path : admin_pages_path
				)
			) do %>
				<button class="icon_button" title="<%= _('explain_unlocking') %>">
					<%= render_icon('close') %>
				</button><br />
				<label><%= _("unlock_page") %></label>
			<% end %>
		</div>
		<div class="button_with_label">
			<%- if configuration(:cache_pages) -%>
				<% form_tag(
					publish_admin_page_path(@page),
					:onsubmit => "pleaseWaitOverlay();"
				) do -%>
					<button class="icon_button" title="<%= _('explain_publishing') %>">
						<%= render_icon('flush') %>
					</button><br />
					<label><%= _("Sweepe cache") %></label>
				<% end -%>
			<%- end -%>
		</div>
		<%- unless @page.layoutpage? -%>
		<div class="button_with_label">
			<%= link_to_overlay_window(
				render_icon('settings'),
				configure_admin_page_path(@page),
				{
					:title => _('edit_page_properties'),
					:size => '380x490'
				},
				:class => 'icon_button',
				:title => _('edit_page_properties')
			) -%><br />
			<label><%= _('page_properties') %></label>
		</div>
		<%- end -%>
		<div class="button_with_label">
			<%= link_to_overlay_window(
				render_icon('new_element'),
				new_admin_element_path(:page_id => @page.id),
				{
					:title => _('Choose Element'),
					:size => '380x50',
					:overflow => true
				},
				{
					:title => _('New Element'),
					:class => 'icon_button'
				}
			) %><br />
			<label><%= _('New Element') %></label>
		</div>
	</div>
</div>
<%- end -%>
<%- content_for :javascripts do -%>
	<script type="text/javascript" charset="utf-8">
	//<!--[CDATA[
		document.observe("dom:loaded", function() {
			openElementsWindow('<%= list_admin_elements_path(:page_id => @page.id) %>', '<%= _('Elements') %>');
			openPreviewWindow('<%= admin_page_url(@page) %>', '<%= _('Page Preview') %>');
		});
	//]]-->
	</script>
<%- end -%>
