(function($) {

<%- if @content.essence_type == "EssencePicture" -%>

  $('#add_content_<%= @element.id -%>').before('<%= escape_javascript(
    render(
      :partial => "essences/essence_picture_editor",
      :locals => {
        :content => @content,
        :options => @options
      }
    )
  ) -%>');
  Alchemy.SortableContents('#element_<%= @element.id -%>_contents', '<%= form_authenticity_token -%>');

  <%- if @contents_of_this_type.length > 1 -%>
  $('#element_<%= @element.id -%>_contents .essence_picture_editor').addClass('dragable_picture');
  <%- end -%>

  <%- if !@options[:maximum_amount_of_images].blank? && (@contents_of_this_type.length >= @options[:maximum_amount_of_images].to_i) -%>
  $("#add_content_<%= @element.id -%>").remove();
  <%- end -%>

  Alchemy.reloadPreview();
  Alchemy.closeCurrentWindow();
  
<%- elsif @content.essence_type ==  "EssenceText" -%>

  <%- locals = {
    :content => @content,
    :options => {:as => 'text_field'}.merge(@options.nil? ? {} : @options)
  } -%>

  <%- if params[:was_missing] -%>

  $("#element_<%= @element.id -%>_content_missing").replaceWith('<%= escape_javascript(
    render(
      :partial => "essences/essence_text_editor",
      :locals => locals
    )
  ) -%>');

  <%- else -%>

  $("#add_content_for_element_<%= @element.id -%>").before('<%= escape_javascript(
    render(
      :partial => "essences/essence_text_editor",
      :locals => locals
    )
  ) -%>');
  Alchemy.reloadPreview();
  Alchemy.closeCurrentWindow();

  <%- end -%>

<%- elsif @content.essence_type ==  "EssenceRichtext" -%>

  <%- locals = {
    :content => @content,
    :options => (@options.nil? ? {} : @options)
  } -%>

  <%- if params[:was_missing] -%>

  $("#element_<%= @element.id -%>_content_missing").replaceWith('<%= escape_javascript(
    render(
      :partial => "essences/essence_richtext_editor",
      :locals => locals
    )
  ) -%>');

  <%- else -%>

  $("#add_content_for_element_<%= @element.id -%>").before('<%= escape_javascript(
    render(
      :partial => "essences/essence_richtext_editor",
      :locals => locals
    )
  ) -%>');
  Alchemy.closeCurrentWindow();

  <%- end -%>

  TinymceHammer.addEditor('contents_content_<%= @content.id -%>_body');

<%- else -%>

  $('#add_content_for_element_<%= @element.id -%>').before('<%= escape_javascript(
    render(
      :partial => "essences/#{@content.essence_type.underscore}_editor",
      :locals => {
        :content => @content,
        :options => (@options.nil? ? {} : @options)
      }
    )
  ) -%>');

<%- end -%>

  Alchemy.growl('<%= _("Successfully added %{content}") % {:content => @content.name} -%>');

})(jQuery);
