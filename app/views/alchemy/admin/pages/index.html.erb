<%- content_for(:subnav_additions) do -%>
<%- unless @locked_pages.blank? -%>
<label><%= t('Active Pages', :scope => :alchemy) %> &raquo;</label>
<%- @locked_pages.each do |page| -%>
<div class="subnavi_tab wide" id="locked_page_<%= page.id %>">
	<%= link_to edit_admin_page_path(page) do %>
	<span class="page_name" title="<%= page.name %>">
		<%= truncate page.name, :length => 15 %>
	</span>
	<% end %>
	<%= form_tag(unlock_admin_page_path(page), :remote => true) do %>
	<button class="icon_button small" title="<%= t('explain_unlocking', :scope => :alchemy) %>">
		<%= render_icon('close small') %>
	</button>
	<% end %>
</div>
<%- end -%>
<%- end -%>
<%- end -%>

<%- content_for :toolbar do -%>
<div id="toolbar_buttons">
	<div class="button_with_label">
		<%= select_tag(
			'language', 
			options_for_select(@languages.map { |l| [l.name, l.id] }, session[:language_id]),
			:onchange => %(
				Alchemy.pleaseWaitOverlay();
				jQuery.get('/admin/pages/switch_language', {
					language_id: this.value
				});
			),
			:class => 'short'
		) %>
		<label><%= t("Language tree", :scope => :alchemy) %></label>
	</div>
	<%- permitted_to?(:flush, :alchemy_admin_pages) do -%>
	<div class="button_with_label">
		<%= link_to(
			render_icon('flush'),
			flush_admin_pages_path,
			:remote => true,
			:method => :post,
			:class => 'icon_button please_wait',
			:title => t('Flush page cache', :scope => :alchemy)
		) -%>
		<label><%= t('Flush page cache', :scope => :alchemy) %></label>
	</div>
	<%- end -%>
	<%- permitted_to?(:sort, :alchemy_admin_pages) do -%>
	<div class="button_with_label" id="page_sorting_button">
		<%= link_to(
			render_icon('sort'),
			sort_admin_pages_path,
			:complete => '',
			:method => :get,
			:remote => true,
			:class => 'icon_button please_wait',
			:title => t('Sort pages', :scope => :alchemy)
		) -%>
		<label><%= t('Sort pages', :scope => :alchemy) %></label>
	</div>
	<%- end -%>
	<div class="button_with_label" id="clipboard_button">
		<%= link_to_overlay_window(
			render_icon("clipboard#{clipboard_empty?('pages') ? '' : ' full'}"),
			admin_clipboard_path(:remarkable_type => 'pages'),
			{
				:title => t('Clipboard', :scope => :alchemy),
				:size => '380x270'
			},
			:class => 'icon_button',
			:title => t('Show clipboard', :scope => :alchemy)
		) -%>
		<label><%= t('Show clipboard', :scope => :alchemy) %></label>
	</div>
</div>
<%- end -%>

<%- if @page_root -%>

<h2 id="sitemap_heading">
	<span class="page_name"><%= t('Name', :scope => :alchemy) %></span>
	<span class="page_infos"><%= t('Status', :scope => :alchemy) %></span>
</h2>

<div id="bottom_panel" style="display: none">
	<div class="info">
		<%= render_icon('info') %>
		<%= t('Explain|Sitemap|Dragndrop sorting', :scope => :alchemy) %>
	</div>
	<div id="bottom_buttons">
		<%= link_to( t('cancel'), admin_pages_path, :class => 'button' , :scope => :alchemy) %>&nbsp;
		<%= submit_tag( t('save order'), :id => 'save_page_order', :class => 'button' , :scope => :alchemy) %>
	</div>
</div>

<%= render :partial => 'sitemap' %>

<%- else -%>

<%= render :partial => 'create_language_form' %>

<%- end -%>
