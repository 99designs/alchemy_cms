<%- content_for(:subnav_additions) do -%>
<%- unless @locked_pages.blank? -%>
<label><%= _('Active Pages') %> &raquo;</label>
<%- @locked_pages.each do |page| -%>
<div class="subnavi_tab wide" id="locked_page_<%= page.id %>">
	<%= link_to edit_admin_page_path(page) do %>
	<span class="page_name" title="<%= page.name %>">
		<%= truncate page.name, :length => 15 %>
	</span>
	<% end %>
	<%= form_tag(unlock_admin_page_path(page), :remote => true) do %>
	<button class="icon_button small" title="<%= _('explain_unlocking') %>">
		<%= render_icon('close small') %>
	</button>
	<% end %>
</div>
<%- end -%>
<%- end -%>
<%- end -%>

<%- content_for :toolbar do -%>
<div id="toolbar">
	<div id="toolbar_buttons">
		<div class="button_with_label">
			<%= select_tag(
				'language', 
				options_for_select(@languages.map { |l| [l.name, l.id] }, session[:language_id]),
				:onchange => %(
					Alchemy.pleaseWaitOverlay();
					jQuery.get('/admin/pages/switch_language', {
						language_id: this.value
					});
				)
			) %>
			<label><%= _("Language tree") %></label>
		</div>
		<%- permitted_to?(:flush, :alchemy_admin_pages) do -%>
		<div class="button_with_label">
			<%= link_to(
				render_icon('flush'),
				flush_admin_pages_path,
				:remote => true,
				:method => :post,
				:class => 'icon_button please_wait_overlay',
				:title => _('Flush page cache')
			) -%>
			<label><%= _('Flush page cache') %></label>
		</div>
		<%- end -%>
		<%- permitted_to?(:sort, :alchemy_admin_pages) do -%>
		<div class="button_with_label" id="page_sorting_button">
			<%= link_to(
				render_icon('sort'),
				sort_admin_pages_path,
				:before => 'Alchemy.pleaseWaitOverlay();',
				:complete => '',
				:method => :get,
				:remote => true,
				:class => 'icon_button please_wait_overlay',
				:title => _('Sort pages')
			) -%>
			<label><%= _('Sort pages') %></label>
		</div>
		<%- end -%>
		<div class="button_with_label" id="clipboard_button">
			<%= link_to_overlay_window(
				render_icon("clipboard#{clipboard_empty?('pages') ? '' : ' full'}"),
				admin_clipboard_path(:remarkable_type => 'page'),
				{
					:title => _('Clipboard'),
					:size => '380x270'
				},
				:class => 'icon_button',
				:title => _('Show clipboard')
			) -%>
			<label><%= _('Show clipboard') %></label>
		</div>
	</div>
</div>
<%- end -%>

<%- if @page_root -%>

<h2 id="sitemap_heading">
	<span class="page_name"><%= _('Name') %></span>
	<span class="page_infos"><%= _('Status') %></span>
</h2>

<div id="bottom_panel" style="display: none">
	<div class="info">
		<%= render_icon('info') %>
		<%= _('Explain|Sitemap|Dragndrop sorting') %>
	</div>
	<div id="bottom_buttons">
		<%= link_to( _('cancel'), admin_pages_path, :class => 'button', :onclick => 'Alchemy.pleaseWaitOverlay()' ) %>&nbsp;
		<%= submit_tag( _('save order'), :id => 'save_page_order', :class => 'button', :onclick => 'Alchemy.pleaseWaitOverlay()' ) %>
	</div>
</div>

<%= render :partial => 'sitemap' %>

<%- else -%>

<%= render :partial => 'create_language_form' %>

<%- end -%>
