<ul id="sitemap" class="list">
	<div class="page_root">
		<div class="sitemap_page<%= @page_root.locked ? ' locked' : '' %>">
			<div class="sitemap_left_images">
				<span class="site_status tooltip"></span>
				<div class="tooltip_content" style="display: none;">
					<h1><%= t("page_type", :scope => :alchemy) %>: <%= @page_root.layout_display_name %></h1>
					<p>
						<%= @page_root.humanized_status %>
					</p>
					<p>
						<strong><%= t("created_at", :scope => :alchemy) %>:</strong>
						<%= l(@page_root.created_at) %> von <%= @page_root.creator %>
					</p>
					<p>
						<strong><%= t("updated_at", :scope => :alchemy) %>:</strong>
						<%= l(@page_root.updated_at) %> durch <%= @page_root.updater %>
					</p>
					<%- if @page_root.locked? -%>
					<p>
						<%= t("currently_edited_by", :scope => :alchemy) %>: <span style="font-weight: bold;"><%= @page_root.current_editor %></span>
					</p>
					<%- end -%>
				</div>
			</div>
			<div class="sitemap_right_tools">
				<%- unless @sorting -%>
				<%- permitted_to?(:configure, :alchemy_admin_pages) do -%>
				<%= link_to_overlay_window(
					render_icon('configure_page'),
					configure_admin_page_path(@page_root),
					{
						:title => t('edit_page_properties', :scope => :alchemy),
						:size => @page_root.redirects_to_external? ? '410x270' : '410x620'
					},
					:class => '',
					:title => t('edit_page_properties', :scope => :alchemy)
				) -%>
				<%- end -%>
				<%- permitted_to?([:new, :destroy], :alchemy_admin_pages) do -%>
				<span class="sitemap_sitetools">
					<%= render_icon('blank') %>
					<%- permitted_to?(:destroy, :alchemy_admin_pages) do -%>
					<%= link_to_confirmation_window(
						render_icon('delete_page'),
						t("confirm_to_delete_page", :scope => :alchemy),
						url_for(
							:controller => 'pages',
							:action => 'destroy',
							:id => @page_root.id
						),
						{
							:class => "",
							:title => t("delete_page", :scope => :alchemy)
						}
					) -%>
					<%- end -%>
					<%- permitted_to?(:new, :alchemy_admin_pages) do -%>
					<%= link_to_overlay_window(
						render_icon('add_page'),
						new_admin_page_path(:parent_id => @page_root.id),
						{
							:title => t('create_page', :scope => :alchemy),
							:size => '340x150',
							:overflow => true
						},
						:class => '',
						:title => t('create_page', :scope => :alchemy)
					) -%>
					<%- end -%>
				</span>
				<%- end -%>
				<%- end -%>
			</div>
			<div class="page_infos" id="page_<%= @page_root.id %>_infos">
				<%= render :partial => 'page_infos', :locals => {:page => @page_root} %>
			</div>
			<div class="sitemap_sitename">
				<%- if @page_root.redirects_to_external? -%>
				<span class="sitemap_pagename_link <%= cycle('even', 'odd') %> inactive"><%= @page_root.name %></span>
				<span class="redirect_url">
					&raquo; <%= t('Redirects to', :scope => :alchemy) %>:
					<%= h @page_root.urlname %>
				</span>
				<%- else -%>
				<%- cycle_class = cycle('even', 'odd') -%>
				<%= link_to_unless(
					@sorting,
					@page_root.name,
					edit_admin_page_path(@page_root),
					:title => t("edit_page", :scope => :alchemy),
					:class => "sitemap_pagename_link #{cycle_class}"
				) { content_tag('span', @page_root.name, :class => "sitemap_pagename_link #{cycle_class}") } -%>
				<%- end -%>
			</div>
		</div>
	</div>
	<%= render :partial => 'page', :collection => @page_root.children %>
</ul>
