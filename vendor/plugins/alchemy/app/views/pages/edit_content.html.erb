<%- wa_assets_set(:edit_page) -%>

<%- content_for(:javascript_includes) do -%>
	<%= tinymce_hammer_javascript_tags %>
<%- end -%>

<div id="top_menu">
	<div id="sub_navigation">
		<span class="page_status_and_name">
			<%= render :partial => 'page_status', :locals => {:page => @page} %>
			<%= @page.name %>&nbsp;<%= image_tag("flags/#{session[:language]}.png", :plugin => :alchemy) if configuration(:languages).size > 1 && !@layoutpage %>
		</span>
	</div>

	<div id="toolbar">
		<div id="toolbar_buttons">
			<div class="button_with_label">
				<% form_tag(
					unlock_page_path(
						@page,
						:redirect_to => @layoutpage ? layoutpages_path : pages_path
					)
				) do %>
					<button class="icon_button" title="<%= _('explain_unlocking') %>">
						<%= image_tag('icons/cross.png', :plugin => 'alchemy') %>
					</button><br />
					<label><%= _("unlock_page") %></label>
				<% end %>
			</div>
			<div class="button_with_label">
				<%- if configuration(:cache_pages) -%>
					<% form_tag(
						publish_page_path(@page),
						:onsubmit => "pleaseWaitOverlay();"
					) do -%>
						<button class="icon_button" title="<%= _('explain_publishing') %>">
							<%= image_tag('icons/globe-green.png', :plugin => 'alchemy') %>
						</button><br />
						<label><%= _("publish_page") %></label>
					<% end -%>
				<%- end -%>
			</div>
			<%- unless @page.layoutpage? -%>
			<div class="button_with_label">
				<%= link_to_wa_window(
					content_tag('span', '', :class => 'icon settings'),
					edit_page_path(@page),
					{
						:title => _('edit_page_properties'),
						:size => '380x490'
					},
					:class => 'icon_button',
					:title => _('edit_page_properties')
				) -%><br />
				<label><%= _('page_properties') %></label>
			</div>
			<%- end -%>
		</div>
	</div>
	<%= render :partial => 'partials/flash_notice' %>
</div>

<div id="page_edit_tools" style="width: 400px">
	<%= render :partial => 'add_element', :locals => {:element_before => nil, :open_element_selector => false} %>
	<div id="element_area">
		<%= render :partial => @page.elements, :locals => {:open_element_selector => false} %>
	</div>
</div>

<div id="preview">
	<iframe id="preview_frame" src="<%= generate_preview_url(frame_requested?) %>" scrolling="auto" frameborder="0"></iframe>
</div>

<%- content_for :javascripts do -%>
	<%= sortable_element(
		"element_area",
		:url => {
			:controller => 'elements',
			:action => "order"
		},
		:scroll => "window",
		:tag => 'div',
		:only => 'dragable',
		:dropOnEmpty => false,
		:handle => 'element_handle'
	) %>
	<script type="text/javascript" charset="utf-8">
	//<!--[CDATA[
		document.observe("dom:loaded", function() {
			tool_window = new Window({
				className: 'wa_window',
				title: 'huhu',
				width: 420,
				height: 400,
				minWidth: 420,
				minHeight: 200,
				maxHeight: document.viewport.getDimensions().height - 100,
				maximizable: false,
				minimizable: true,
				resizable: true,
				draggable: true,
				zIndex: 300000,
				closable: false,
				destroyOnClose: true,
				recenterAuto: false,
				effectOptions: {
					duration: 0.2
				}
			});
			tool_window.setContent('page_edit_tools', true, true);
			tool_window.showCenter(false, 50, document.viewport.getDimensions().width - 450);
		});
	//]]-->
	</script>
<%- end -%>
