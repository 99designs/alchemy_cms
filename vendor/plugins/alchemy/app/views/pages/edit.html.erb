<%- wa_assets_set(:edit_page) -%>

<%- content_for(:javascript_includes) do -%>
	<%= tinymce_hammer_javascript_tags %>
<%- end -%>

<div id="top_menu">
	<div id="sub_navigation">
		<span class="page_status_and_name">
			<%= render :partial => 'page_status', :locals => {:page => @page} %>
			<%= @page.name %>&nbsp;<%= image_tag("flags/#{session[:language]}.png", :plugin => :alchemy) if configuration(:languages).size > 1 && !@layoutpage %>
		</span>
	</div>

	<div id="toolbar">
		<div id="toolbar_buttons">
			<div class="button_with_label">
				<% form_tag(
					unlock_page_path(
						@page,
						:redirect_to => @layoutpage ? layoutpages_path : pages_path
					)
				) do %>
					<button class="icon_button" title="<%= _('explain_unlocking') %>">
						<%= image_tag('icons/cross.png', :plugin => 'alchemy') %>
					</button><br />
					<label><%= _("unlock_page") %></label>
				<% end %>
			</div>
			<div class="button_with_label">
				<%- if configuration(:cache_pages) -%>
					<% form_tag(
						publish_page_path(@page),
						:onsubmit => "pleaseWaitOverlay();"
					) do -%>
						<button class="icon_button" title="<%= _('explain_publishing') %>">
							<%= image_tag('icons/globe-green.png', :plugin => 'alchemy') %>
						</button><br />
						<label><%= _("publish_page") %></label>
					<% end -%>
				<%- end -%>
			</div>
			<%- unless @page.layoutpage? -%>
			<div class="button_with_label">
				<%= link_to_overlay_window(
					content_tag('span', '', :class => 'icon settings'),
					configure_page_path(@page),
					{
						:title => _('edit_page_properties'),
						:size => '380x490'
					},
					:class => 'icon_button',
					:title => _('edit_page_properties')
				) -%><br />
				<label><%= _('page_properties') %></label>
			</div>
			<%- end -%>
			<div class="button_with_label disabled" id="ElementsWindowButton">
				<%= link_to_function(
					content_tag('span', '', :class => 'icon elements_window'),
					"openElementsWindow(#{@page.id}, '#{_('Elements')}')",
					:class => 'icon_button',
					:title => _('Show Elements')
				) -%><br />
				<label><%= _('Open Elements panel') %></label>
			</div>
			<div class="button_with_label">
				<%= link_to_overlay_window(
					content_tag('span', '', :class => 'icon new_element'),
					new_element_path(:page_id => @page.id),
					{
						:title => _('Choose Element'),
						:size => '380x50',
						:overflow => true
					},
					{
						:title => _('New Element'),
						:class => 'icon_button'
					}
				) %><br />
				<label><%= _('New Element') %></label>
			</div>
		</div>
	</div>
	<%= render :partial => 'partials/flash_notice' %>
</div>

<div id="preview">
	<iframe id="preview_frame" src="<%= generate_preview_url(frame_requested?) %>" scrolling="auto" frameborder="0"></iframe>
</div>

<%- content_for :javascripts do -%>
	<script type="text/javascript" charset="utf-8">
	//<!--[CDATA[
		document.observe("dom:loaded", function() {
			openElementsWindow(<%= @page.id %>, '<%= _('Elements') %>');
		});
	//]]-->
	</script>
<%- end -%>
