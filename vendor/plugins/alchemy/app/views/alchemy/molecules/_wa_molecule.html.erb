<%- has_rtf_atoms = molecule.atoms.detect { |atom| atom.atom_type == 'WaAtomRtf' } -%>

<div class="dragable" id="<%= "dragable_#{molecule.id}" %>">
	<div class="molecule_editor" id="molecule_<%= molecule.id %>">
		<%= render :partial => "molecules/molecule_head", :locals => {:molecule => molecule} %>
		<%- if !molecule.folded? -%>
			<% form_remote_tag(
				:url => molecule_path(molecule),
				:method => :put,
				:before => (has_rtf_atoms ? "saveRtfAtoms(#{molecule.id})" : nil),
				:loading => %(
					$('molecule_#{molecule.id}_save').hide();
					$('molecule_#{molecule.id}_spinner').show();
				),
				:html => {
					:id => "molecule_#{molecule.id}_form"
				}
			) do %>
				<div id="molecule_<%= molecule.id %>_content" class="molecule_content">
					<%= render_editor(molecule) %>
				</div>
				<%= render :partial => 'molecules/save_and_delete_buttons', :locals => {:molecule => molecule} %>
			<% end %>
		<%- end -%>
	</div>
	<%= render :partial => 'pages/add_molecule', :locals => {:molecule_before => molecule, :open_molecule_selector => false} %>
</div>