<%- wa_assets_set(:edit_page) -%>

<%- content_for(:framesize) { '400px' } -%>

<%- content_for(:javascript_includes) do -%>
	<%= tinymce_hammer_javascript_tags %>
<%- end -%>

<div id="page_editing_notices">
	<%= render :partial => 'partials/flash_notice' %>
</div>

<div class="wa_legend">
	<div id="page_editing_head">
		<div class="first_column">
			<%= render :partial => 'page_status', :locals => {:page => @page} %>
			<span class="page_name">
				<%= @page.name %>&nbsp;<%= image_tag("flags/#{session[:language]}.png", :plugin => :alchemy) if configuration(:languages).size > 1 && !@systempage %>
			</span>
		</div>
		<div class="second_column">
			<%- unless @page.systempage? -%>
			<%= link_to_wa_window(
				"",
				edit_page_path(@page),
				{
					:title => _('edit_page_properties'),
					:size => '380x490'
				},
				:class => 'edit_page_names_button',
				:title => _('edit_page_properties')
			) -%>
			<%- end -%>
		</div>
	</div>
	<div id="page_status_options">
		<div class="first_column">
			<%- if configuration(:cache_pages) -%>
				<% form_tag(
					publish_page_path(@page),
					:onsubmit => "pleaseWaitOverlay();"
				) do -%>
					<%= submit_tag( _("publish_page"), :class => 'button', :name => nil, :title => _('explain_publishing')) %>
				<% end -%>
			<%- end -%>
		</div>
		<div class="second_column">
			<% form_tag(
				unlock_page_path(
					@page,
					:redirect_to => @systempage ? systempages_path : pages_path
				)
			) do %>
				<%= submit_tag(_("unlock_page"), :class => 'button', :name => nil, :title => _('explain_unlocking')) %>
			<% end %>
		</div>
	</div>
</div>

<%= render :partial => 'add_molecule', :locals => {:molecule_before => nil, :open_molecule_selector => false} %>

<div id="molecule_area">
	<%= render :partial => @page.molecules, :locals => {:open_molecule_selector => false} %>
</div>

<%- content_for :javascripts do -%>
	<%= sortable_element(
		"molecule_area",
		:url => {
			:controller => 'molecules',
			:action => "order"
		},
		:scroll => "window",
		:tag => 'div',
		:only => 'dragable',
		:dropOnEmpty => false,
		:handle => 'molecule_handle'
	) %>
<%- end -%>
